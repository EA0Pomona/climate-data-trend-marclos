---
title: ""
author: "Khalil Johnson"
date: "2/19/2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Why Should We Care About Temperature Change?

First, we will import the CSV file. In most cases, we don't need to preprocess the csv files. 
```{r importingCSV}
# Importing Scripts

file = "/home/CAMPUS/kaj41925/Climate_Change_Narratives/Khalil/NewOrleansNOAAdata.csv"

import = read.csv(file)
```

## Checking the Data(echo = False)

```{r checking}(echo = False)
plot(TMAX~DATE, import)(echo = False)
```

What's going on?  What is the deal with the -9999? These are used for missing data. We need to remove them!(echo = False)

```{r missings}(echo = False)
import$TMAX[import$TMAX==-9999] = NA
import$TMIN[import$TMIN==-9999] = NA
```

Okay, now we'll check again, for dates less then Dec. 31, 1913:(echo = False)
```{r}(echo = False)
plot(TMAX~DATE, import[import$DATE<19131231,], ty='l')(echo = False)
```

Yikes! What's wrong? As it turns it the problem is that with how the dates are specified. In particular, the Dec 31 to Jan 1 transition:(echo = False) 

19131231 -> 19140101, if you use these as numbers it should be 19131232, 19131232, etc. You see we are missing lots numbers!(echo = False)


```{r}(echo = False)
plot(TMAX~DATE, import[import$DATE<19130102,], ty='l')(echo = False)
```

## Fixing the Dates(echo = False)

First, we convert the date a string or character values. Next, we'll convert the strings to a data format.(echo = False) 

```{r}(echo = False)
strDates <- as.character(import$DATE)(echo = False)
head(strDates)(echo = False)
import$NewDate <- as.Date(strDates, "%Y%m%d")(echo = False)
```

## Checking the New Dates
```{r}(echo = False)
plot(TMAX~NewDate, import[import$DATE<19130102,], ty='l')
```
## Subset Sites

Olivia has two sites in here data, so, we need to subset it.

```{r}(echo = False)
unique(import$STATION_NAME)
```

Let's choose the FAIRPLEX NY US because the record is longer than the airport.

```{r}(echo = False)
LosAngeles <- subset(import, STATION_NAME=="NEW ORLEANS AUDUBON LA US", select=c(STATION, STATION_NAME, DATE, NewDate, TMIN, TMAX, PRCP))
```


## A new plot
```{r}(echo = False)
plot(TMAX~NewDate, LosAngeles, ty='l')
```

## Evaluating the trend

Creating a linear model and then evaluate the rate (slope). 
```{r}(echo = False)
# Linear Model
LosAngeles.lm <- lm(TMAX~NewDate, data=LosAngeles)
summary(LosAngeles.lm)
plot(TMAX~NewDate, LosAngeles, ty='l')
abline(coef(LosAngeles.lm), col='red')
```

## Creating Month and Year Variables

So, let's figure out how to see how changes happen for individual months.
```{r}(echo = False)
# Get months
LosAngeles$Month = months(LosAngeles$NewDate) # Creates problems.
LosAngeles$Month = format(as.Date(LosAngeles$NewDate), format = "%m")
LosAngeles$Year = format(LosAngeles$NewDate, format="%Y")
```

### Creating Monthly Means
```{r creatingmonthlymeans}(echo = False)
MonthlyMean = aggregate(TMAX ~ Month + Year, LosAngeles, mean)

MonthlyMean$YEAR = as.numeric(MonthlyMean$Year)
MonthlyMean$MONTH = as.numeric(MonthlyMean$Month)


# Frank -- change mean to sd and you'll get standard deviation for each month/year.

MonthlySD = aggregate(TMAX ~ Month + Year, LosAngeles, sd)(echo = False)

MonthlySD$YEAR = as.numeric(MonthlySD$Year)
MonthlySD$MONTH = as.numeric(MonthlySD$Month)
MonthlySD$NewDate = MonthlySD$YEAR + (MonthlySD$MONTH - 1)/12

head(MonthlySD)
```


```{r plottingMonthyMeans}(echo = False)
plot(MonthlyMean$TMAX, ty='l')

```
below is sd
```{r plottingMonthySD}(echo = False)
plot(MonthlySD$TMAX, ty='l')

plot(TMAX~ NewDate, data=MonthlySD, ty='l')
SD.lm <- lm(TMAX~NewDate, data=MonthlySD)
summary(SD.lm)

abline(coef(SD.lm), col="red")

```



### Selecting for 1 Month -- June 

Perhaps, we can can understand the temperature change in New Orleans if we analyze for just one month at a time!
This is June

```{r June}
plot(MonthlyMean$TMAX[MonthlyMean$Month=="06"], ty='l')
plot(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="06",], ty='l') 
May.lm <- lm(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="06",])
summary(May.lm)

abline(coef(May.lm), col="red")
```

The Times-Picayune reported in 2015 that June brought 21 days of heatwave weather. Without a doubt patterns of that nature has contributed to the overall rise in temperatures in June.Overtime, one can see a sharp incline in the summer month.  

```{r July}
plot(MonthlyMean$TMAX[MonthlyMean$Month=="07"], ty='l')
plot(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="07",], ty='l') 
May.lm <- lm(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="07",])
summary(May.lm)

abline(coef(May.lm), col="red")
```

The same Ne Orleans based newspaper reported that July reported 31 days, an entire month, of abnormally high temperatures. July, while a summer month, historically has not reached these hights in temperature. There is a clear trend here that indicates a more dangerous summer in the city. 

```{r August}
plot(MonthlyMean$TMAX[MonthlyMean$Month=="08"], ty='l')
plot(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="08",], ty='l') 
May.lm <- lm(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="08",])
summary(May.lm)

abline(coef(May.lm), col="red")
```

August has a kess steep incline, but still requires attention. This month saw a 25 day heatwave, that gave a bange to the end of the summer. 

```{r September}
plot(MonthlyMean$TMAX[MonthlyMean$Month=="09"], ty='l')
plot(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="09",], ty='l') 
May.lm <- lm(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="09",])
summary(May.lm)

abline(coef(May.lm), col="red")
```

THis month is what should alarm residents of New Orleans. The summer concludes in August and the temperatures should subside in September. This month cools down the city and prepares the weather for fall temperatures. Interestingly, temperatures are rising in this month. Cooler temperatures are displaced, and this extends the summer to another month. 

```{r October}
plot(MonthlyMean$TMAX[MonthlyMean$Month=="10"], ty='l')
plot(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="10",], ty='l') 
May.lm <- lm(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="10",])
summary(May.lm)

abline(coef(May.lm), col="red")
```

October experiences the same unfortunate weather. Halloween, a wildly popular holiday in New Orleans, was the hottest on record. Summer has officially extended deep into the fall, close to winter temperatures.

This will have an enourmous impact on vulnerable communities. Eliot Kamenitz of The Times-Picayune details the drastic efforts that the city must take to protect underserved citizens from the heat. 

Now, the change is `r coef(May.lm)[2]` degress/year or `r round(coef(May.lm)[2]*100, 3)` degress/100 years (YIKES!) with a probability of `r round(summary(May.lm)$coefficients[2,4],4)`. Although we can't reject the null hypothesis, it is worrying!

```{r}(echo = False)
plot(MonthlyMean$TMAX[MonthlyMean$Month=="12"], ty='l')
plot(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="12",], ty='l') 
Dec.lm <- lm(TMAX~YEAR, data=MonthlyMean[MonthlyMean$Month=="12",])
summary(Dec.lm)

abline(coef(Dec.lm), col="red")

```

## TMIN

1. We create a monthly mean for each month.

```{r}(echo = False)
MonthlyMeanTMIN = aggregate(TMIN ~ Month + Year, LosAngeles, mean)

MonthlyMeanTMIN$YEAR = as.numeric(MonthlyMeanTMIN$Year)
head(MonthlyMeanTMIN)
```

2. Now we plot the mins, and again, find tons of scatter.

```{r}(echo = False)
plot(MonthlyMeanTMIN$TMIN, ty='l')

plot(MonthlyMeanTMIN$TMIN[MonthlyMeanTMIN$Month=="12"], ty='l')

plot(TMIN~YEAR, data=MonthlyMeanTMIN[MonthlyMeanTMIN$Month=="12",], ty='l') 
Dec.lm <- lm(TMIN~YEAR, data=MonthlyMeanTMIN[MonthlyMeanTMIN$Month=="12",])
summary(Dec.lm)

abline(coef(Dec.lm), col="red")

# Departure from Mean

```{r}(echo = False)
PRCP_mean = mean(LosAngeles$PRCP, na.rm=T)

plot(PRCP~NewDate, data=LosAngeles)
abline(h=PRCP_mean, col="blue")

```{r}(echo = False)
LosAngeles$PRCP[LosAngeles$PRCP==-9999] <- NA
YearlySum = aggregate(PRCP ~ Year, LosAngeles, sum)
YearlySum$YEAR = as.numeric(YearlySum$Year) 
YearlyMean = mean(YearlySum$PRCP)
```

```{r}(echo = False)
plot(PRCP~YEAR, data=YearlySum, las=1, ty="p")
abline(h=YearlyMean, col="blue")
YearlySum.lm = lm(PRCP~YEAR, data=YearlySum)
abline(coef(YearlySum.lm), col="green")

```{r}(echo = False)
summary(YearlySum.lm)
```

Other attempts that didn't work!
```{r}(echo = False)
YearlySum2 = subset(YearlySum, select=c(PRCP))
YearlyMean = mean(YearlySum2$PRCP)

#filter(YearlySum2)



#Doesn't work...
# ma <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}
# ma(YearlySum$PRCP)  


yearlyts =ts(YearlySum2) 
str(yearlyts)




```
yearlyts.lag = lag(yearlyts, 5)[6:112,]; head(yearlyts.lag)

plot(yearlyts, lty = 1, col = 3)

lines(yearlyts.lag)

YearlySum$Departure = YearlyMean - YearlySum$PRCP
YearlySum$YEAR = as.numeric(YearlySum$Year)

plot(PRCP~YEAR, data=YearlySum, las=1, ty="l")
abline(h=YearlyMean, col="blue")

lines(Departure ~ YEAR, data=YearlySum, col="red")
