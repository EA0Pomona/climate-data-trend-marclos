\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

\title{Is the global temperature increasing?}
\author{Marc Los Huertos}
\date{}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}

\maketitle

\section{Introduction}

According the the IPCC, the temperature has been changing about 0.X degrees per XX years -- but how is this value derived? How reliable is the value?  

\subsection{Learning Goals}

For this project, you will evaluate determine if the Earth's temperature has in fact changed, and if so, by how much?

\subsection{Driving Question}

Is my region's climate changing?

How does climate change impact my community?

\subsection{Public Product}

Narrative Blog...

with professional graphics and statistics.

\subsection{Approach}


\section{Procedures}

\subsection{How is temperature data collected?}

\subsection{How are the data store, curated and checked for quality?}

\section{Data Source}


\subsection{Compressed Files}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# Uncompress the files.}
\hlcom{# ghcnd_all}

\hlstd{tarfile} \hlkwb{=} \hlstr{"C:\textbackslash{}\textbackslash{}workspace\textbackslash{}\textbackslash{}GitHub\textbackslash{}\textbackslash{}RTricks\textbackslash{}\textbackslash{}300_Global_Warming\textbackslash{}\textbackslash{}Raw Data\textbackslash{}\textbackslash{}ghcnd_all.tar.gz"}

\hlcom{#ftpsource = ftp://ftp.ncdc.noaa.gov/pub/data/ghcn/v3/ghcnm.tmax.latest.qca.tar.gz}


\hlcom{#ghcnm.tmax.latests.qca.tar.qz}
\hlstd{tarfile} \hlkwb{=} \hlstr{"C:\textbackslash{}\textbackslash{}workspace\textbackslash{}\textbackslash{}GitHub\textbackslash{}\textbackslash{}RTricks\textbackslash{}\textbackslash{}300_Global_Warming\textbackslash{}\textbackslash{}Raw Data\textbackslash{}\textbackslash{}ghcnm.tmax.latest.qca.tar.gz"}
\hlcom{# untar(tarfile)}
\end{alltt}
\end{kframe}
\end{knitrout}


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{#stationfile = "C:\textbackslash{}\textbackslash{}workspace\textbackslash{}\textbackslash{}GitHub\textbackslash{}\textbackslash{}RTricks\textbackslash{}\textbackslash{}300_Global_Warming\textbackslash{}\textbackslash{}Raw Data\textbackslash{}\textbackslash{}ghcnd-stations.txt"}
\end{alltt}
\end{kframe}
\end{knitrout}

\subsection{Uptain Locations}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# read.table(stationfile, header=F, fill=T, row.names=NULL); head(stations)}
\hlstd{stations} \hlkwb{=} \hlstd{(}\hlkwd{read.fwf}\hlstd{(stationfile,} \hlkwc{fill}\hlstd{=T,} \hlkwc{widths}\hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{11}\hlstd{,} \hlnum{9}\hlstd{,} \hlnum{10}\hlstd{,} \hlnum{7}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{32}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{9}\hlstd{), ))}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in read.fwf(stationfile, fill = T, widths = c(11, 9, 10, 7, 3, 32, : object 'stationfile' not found}}\begin{alltt}
\hlkwd{names}\hlstd{(stations)}\hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"ID"}\hlstd{,} \hlstr{"LAT"}\hlstd{,} \hlstr{"LONG"}\hlstd{,} \hlstr{"ELEV"}\hlstd{,} \hlstr{"STATE"}\hlstd{,} \hlstr{"NAME"}\hlstd{,} \hlstr{"GSN"}\hlstd{,} \hlstr{"HCN_CRN"}\hlstd{,} \hlstr{"WHOID"}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in names(stations) = c("{}ID"{}, "{}LAT"{}, "{}LONG"{}, "{}ELEV"{}, "{}STATE"{}, "{}NAME"{}, : object 'stations' not found}}\begin{alltt}
\hlkwd{head}\hlstd{(stations)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in head(stations): object 'stations' not found}}\begin{alltt}
\hlkwd{str}\hlstd{(stations)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in str(stations): object 'stations' not found}}\end{kframe}
\end{knitrout}

Example of data:

AG000060680  22.8000    5.4331 1362.0    TAMANRASSET                    GSN     60680        
         

subsection{Selecting and Example Location}

Here's what the data look like:

ID            1-11   Character
YEAR         12-15   Integer
MONTH        16-17   Integer
ELEMENT      18-21   Character
VALUE1       22-26   Integer
MFLAG1       27-27   Character
QFLAG1       28-28   Character
SFLAG1       29-29   Character
VALUE2       30-34   Integer
MFLAG2       35-35   Character
QFLAG2       36-36   Character
SFLAG2       37-37   Character
  .           .          .
  .           .          .
  .           .          .
VALUE31    262-266   Integer
MFLAG31    267-267   Character
QFLAG31    268-268   Character
SFLAG31    269-269   Character

Arizona, let's chech import process for the sites...
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{stations[stations}\hlopt{$}\hlstd{ID}\hlopt{==}\hlstr{"US1AZMR0013"}\hlstd{,]}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in eval(expr, envir, enclos): object 'stations' not found}}\begin{alltt}
\hlcom{# head(stations[stations$HCN_CRN==" CRN",])}
\end{alltt}
\end{kframe}
\end{knitrout}

Let's get the arizona data into R
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{file} \hlkwb{=} \hlstr{"C:\textbackslash{}\textbackslash{}workspace\textbackslash{}\textbackslash{}GitHub\textbackslash{}\textbackslash{}RTricks\textbackslash{}\textbackslash{}Climate_Change_Narratives\textbackslash{}\textbackslash{}Data\textbackslash{}\textbackslash{}ghcnd-stations.txt"}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# practicing loops}
\hlkwa{for} \hlstd{(year} \hlkwa{in} \hlkwd{c}\hlstd{(}\hlnum{2010}\hlstd{,}\hlnum{2011}\hlstd{,}\hlnum{2012}\hlstd{,}\hlnum{2013}\hlstd{,}\hlnum{2014}\hlstd{,}\hlnum{2015}\hlstd{))\{}
  \hlkwd{print}\hlstd{(}\hlkwd{paste}\hlstd{(}\hlstr{"The year is"}\hlstd{, year))}
\hlstd{\}}
\end{alltt}
\begin{verbatim}
## [1] "The year is 2010"
## [1] "The year is 2011"
## [1] "The year is 2012"
## [1] "The year is 2013"
## [1] "The year is 2014"
## [1] "The year is 2015"
\end{verbatim}
\begin{alltt}
\hlcom{# Create New Varible Names}
\hlstd{MFLAG}\hlkwb{=}\hlnum{NA}\hlstd{; QFLAG}\hlkwb{=}\hlnum{NA}\hlstd{; SFLAG}\hlkwb{=}\hlnum{NA}\hlstd{; VALUE}\hlkwb{=}\hlnum{NA}
\hlkwa{for} \hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlnum{31}\hlstd{)\{}
\hlstd{VALUE[i]} \hlkwb{=} \hlkwd{paste}\hlstd{(}\hlstr{"DATE"}\hlstd{, i,} \hlkwc{sep}\hlstd{=}\hlstr{""}\hlstd{)}
\hlstd{MFLAG[i]} \hlkwb{=} \hlkwd{paste}\hlstd{(}\hlstr{"MFLAG"}\hlstd{, i,} \hlkwc{sep}\hlstd{=}\hlstr{""}\hlstd{)}
\hlstd{QFLAG[i]} \hlkwb{=} \hlkwd{paste}\hlstd{(}\hlstr{"QFLAG"}\hlstd{, i,} \hlkwc{sep}\hlstd{=}\hlstr{""}\hlstd{)}
\hlstd{SFLAG[i]} \hlkwb{=} \hlkwd{paste}\hlstd{(}\hlstr{"SFLAG"}\hlstd{, i,} \hlkwc{sep}\hlstd{=}\hlstr{""}\hlstd{)}
\hlstd{\}}

\hlkwd{print}\hlstd{(QFLAG)}
\end{alltt}
\begin{verbatim}
##  [1] "QFLAG1"  "QFLAG2"  "QFLAG3"  "QFLAG4"  "QFLAG5"  "QFLAG6"  "QFLAG7" 
##  [8] "QFLAG8"  "QFLAG9"  "QFLAG10" "QFLAG11" "QFLAG12" "QFLAG13" "QFLAG14"
## [15] "QFLAG15" "QFLAG16" "QFLAG17" "QFLAG18" "QFLAG19" "QFLAG20" "QFLAG21"
## [22] "QFLAG22" "QFLAG23" "QFLAG24" "QFLAG25" "QFLAG26" "QFLAG27" "QFLAG28"
## [29] "QFLAG29" "QFLAG30" "QFLAG31"
\end{verbatim}
\begin{alltt}
\hlcom{# Vector of variable names converted from a transposed matrix}
\hlstd{tmp} \hlkwb{=} \hlkwd{as.vector}\hlstd{(}\hlkwd{t}\hlstd{(}\hlkwd{matrix}\hlstd{(}\hlkwc{data}\hlstd{=}\hlkwd{c}\hlstd{(VALUE, MFLAG, QFLAG, SFLAG),} \hlkwc{ncol}\hlstd{=}\hlnum{4}\hlstd{)))}
\hlstd{Names} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"ID"}\hlstd{,} \hlstr{"YEAR"}\hlstd{,} \hlstr{"MONTH"}\hlstd{,} \hlstr{"ELEMENT"}\hlstd{, tmp);} \hlkwd{length}\hlstd{(Names)}
\end{alltt}
\begin{verbatim}
## [1] 128
\end{verbatim}
\begin{alltt}
\hlcom{# Read the file}
\hlstd{test} \hlkwb{=} \hlkwd{read.fwf}\hlstd{(file,}\hlkwc{widths} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{11}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{4}\hlstd{,} \hlkwd{rep}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{5}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,} \hlnum{1}\hlstd{),}\hlnum{31}\hlstd{)))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in file(file, "{}rt"{}): cannot open file 'C:\textbackslash{}workspace\textbackslash{}GitHub\textbackslash{}RTricks\textbackslash{}Climate\_Change\_Narratives\textbackslash{}Data\textbackslash{}ghcnd-stations.txt': No such file or directory}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in file(file, "{}rt"{}): cannot open the connection}}\begin{alltt}
\hlkwd{str}\hlstd{(test)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in str(test): object 'test' not found}}\begin{alltt}
\hlkwd{names}\hlstd{(test)}\hlkwb{=} \hlstd{Names; test}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in names(test) = Names: object 'test' not found}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in eval(expr, envir, enclos): object 'test' not found}}\begin{alltt}
\hlkwd{head}\hlstd{(test)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in head(test): object 'test' not found}}\end{kframe}
\end{knitrout}



setwd("C:\\workspace\\GitHub\\RTricks\\300_Global_Warming\\ghcnd_all")

temp = list.files(pattern="*.dly"); head(temp)
#for (i in 1:length(temp)) 
for (i in 1:2){
tmp <- read.fwf(temp[i], widths = c(11, 4, 2, 4, rep(c(5, 1, 1, 1),31)))
names(tmp) <- Names
assign(temp[i], subset(tmp, ELEMENT=="TMAX", select=c(1:4, seq(5, by = 4, length.out=31))))
}

library(tidyr)
library(dplyr)
library(stringr)
str(AGM00060515.dly)
gather(AGM00060515.dly, "Temp", VALUE1)

library(reshape)
tmp1 = melt(AGM00060515.dly, id=c("ID", "YEAR", "MONTH", "ELEMENT"))
head(tmp1)
tmp1$Day = as.numeric(str_sub(tmp1$variable,6,7)); head(tmp1)
tmp1$value[tmp1$value==-9999] = NA; head(tmp1)
tmp1$Temperature = tmp1$value/10

drops <- c("variable","value")
tmp1[ , !(names(tmp1) %in% drops)]
tmp1$DECADE = round(tmp1$YEAR, -1)

test1 = aggregate(Temperature ~ DECADE, tmp1, sd)
test2 = aggregate(Temperature ~ DECADE, tmp1, mean)
head(test2)
names(test2[,2]) = "Mean"

test2$Range = test1$Mean + test2$Temperature

plot(test2$DECADE, test2$Mean)

points(test1$DECADE, test1$Temperature)


#full_join(test1, test2, by = list("MONTH", "DECADE"))







%http://www.r-bloggers.com/accessing-cleaning-and-plotting-noaa-temperature-data/


New NOAA Directory -- ftp://ftp.ncdc.noaa.gov/pub/data/noaa/


library(raster)
library(XML)

coords.fwt <- read.fwf("ftp://ftp.ncdc.noaa.gov/pub/data/noaa/isd-history.txt",widths=c(6,1,5,1,38,7,1,8,9,8,1,8),sep=";",skip=22,fill=T)
Names = c("USAF", "X1", "WBAN", "X2", "STATION_NAME", "X3", "CTRY", "X4", "ST", "X5", "CALL", "X6", "LAT", "X7", "LON", "X8", "ELEV", "X9", "BEGIN", "X10", "END")
Widths = c(6,       1,    5,      1,        29,         1,    2,      3,    2,    1,    4,      1,    8,     1,     8,    1,    7,     1,     8,      1,    8)

coords.fwt <- read.fwf("ftp://ftp.ncdc.noaa.gov/pub/data/noaa/isd-history.txt",widths=Widths,sep=";",skip=22,fill=T); names(coords.fwt)=Names; coords.fwt[c(30,4000,20000),]

coords <- data.frame(ID=paste(as.factor(coords.fwt[,1])),WBAN=paste(as.factor(coords.fwt[,3])),Lat=as.numeric(paste(coords.fwt$LAT)),Lon=as.numeric(paste(coords.fwt$LON)));  coords[c(30,4000,20000),]


plot()


\end{document}
